---
import { getCollection } from 'astro:content';
const posts = await getCollection('posts');
const sortedPosts = posts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
---

<h1>Archivio Blog</h1>
<ul class="post-list">
  {sortedPosts.map(post => (
    <li class="post-preview">
      <a href={post.slug ? `/posts/${post.slug}/` : '#'}>
        {post.data.cover && <img src={post.data.cover} alt={post.data.title + ' thumbnail'} class="post-thumb" />}
        <h2>{post.data.title}</h2>
        <time datetime={post.data.date.toISOString()}>{post.data.date.toLocaleDateString()}</time>
        <p>{post.body?.slice(0, 120) ?? ''}...</p>
      </a>
    </li>
  ))}
</ul>

<style>
.post-list { list-style: none; padding: 0; }
.post-preview { margin-bottom: 2rem; border-bottom: 1px solid #eee; padding-bottom: 1rem; }
.post-thumb { width: 120px; height: 80px; object-fit: cover; float: left; margin-right: 1rem; border-radius: 6px; }
h2 { margin: 0 0 0.2em 0; }
time { color: #888; font-size: 0.9em; }
p { margin: 0.5em 0 0 0; }
</style>
